---
import Base from "@/layouts/Base.astro";
import SearchBar from "@/layouts/Search";
import { getCollection } from "astro:content";

// Retrieve and sort blog posts, filtering out drafts
const posts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => {
    const dateA = a.data.date ? a.data.date.valueOf() : 0;
    const dateB = b.data.date ? b.data.date.valueOf() : 0;
    return dateB - dateA;
  });

// Map posts to the structure expected by SearchBar
const searchList = posts.map((post) => ({
  slug: post.slug,
  data: {
    title: post.data.title,
    // Ensure author is available for search (singular) and display (plural array)
    author: post.data.author || post.data.authors[0], 
    authors: post.data.authors || [post.data.author],
    categories: post.data.categories,
    tags: post.data.tags,
    date: post.data.date,
    image: post.data.image,
  },
  content: post.body,
}));
---

<Base title="Search">
  <section class="section">
    <div class="container">
      <h1 class="text-center font-normal mb-8">Search Posts</h1>
      <SearchBar client:load searchList={searchList} />
    </div>
  </section>
</Base>
