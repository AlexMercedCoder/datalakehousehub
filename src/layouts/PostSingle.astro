---
import { Image } from "astro:assets";
import { markdownify } from "@/lib/utils/textConverter";
import MDXImage from "@/components/MDXImage.astro";
import Giscus from "@/components/Giscus.astro";
import Share from "@/components/Share.astro";
import RelatedPosts from "@/components/RelatedPosts.astro";
import CopyLink from "@/components/CopyLink";
import readingTime from "@/lib/utils/readingTime";
import TableOfContents from "@/components/TableOfContents.astro";
import { FaRegClock } from "react-icons/fa";

const { post } = Astro.props;
const { Content, headings } = await post.render();
const { title, description, image } = post.data;
const readTime = readingTime(post.body);
---

<section class="section pt-12">
  <div class="container relative">
    <div class="row">
      <div class="hidden lg:block lg:col-3">
         <div class="sticky top-24">
             <TableOfContents headings={headings} />
         </div>
      </div>

      <div class="col-12 lg:col-9">
        <article>
          <div class="mb-12 text-center">
             <div class="flex items-center justify-center gap-3 mb-4">
                <h1 set:html={markdownify(title)} class="h2 lg:h1 font-extrabold text-dark dark:text-white tracking-tight" />
                <CopyLink client:load className="text-primary hover:text-primary/80 transition-colors" />
             </div>
            
            <div class="flex items-center justify-center gap-4 text-text dark:text-light mb-6 text-sm">
                <span class="flex items-center gap-1">
                    <FaRegClock /> {readTime}
                </span>
            </div>

            <hr class="w-24 h-1 mx-auto bg-primary rounded border-0">
          </div>
            
            {image && (
            <div class="mb-10 text-center">
              <Image
                src={image}
                alt={title}
                height={500}
                width={1000}
                class="rounded-lg w-full"
              />
            </div>
          )}

          <div class="content prose prose-lg dark:prose-invert max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-a:text-primary hover:prose-a:text-primary/80 prose-img:rounded-xl prose-img:shadow-lg">
            <div class="lg:hidden mb-8">
                <TableOfContents headings={headings} />
            </div>
            <Content components={{img: MDXImage}} />
          </div>
          
          <div class="mt-12 flex justify-between items-center border-t border-border py-6">
             <h5 class="mr-3">Share :</h5>
             <Share
              className="social-icons"
              title={title}
              description={description}
              slug={post.slug}
            />
          </div>

          <Giscus />
        </article>
      </div>
    </div>
    
    <RelatedPosts post={post} />
  </div>
</section>
